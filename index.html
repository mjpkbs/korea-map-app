<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<<<<<<< HEAD
    <title>Korean Administrative Districts Map</title>
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            background-color: #f5f5f5;
        }
        
        #map {
            width: 100vw;
            height: 100vh;
        }
        
        .controls {
            position: absolute;
            top: 10px;
            left: 10px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            max-width: 300px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .control-group {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .control-group:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        
        select, input[type="text"], input[type="color"] {
            width: 100%;
=======
    <title>Korean Administrative Map</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ—ºï¸</text></svg>">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 100vh;
            display: flex;
        }

        #map {
            flex: 1;
            height: 100vh;
        }

        .controls {
            width: 350px;
            background: #fff;
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            overflow-y: auto;
            height: 100vh;
        }

        .control-group {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .control-group:last-child {
            border-bottom: none;
        }

        .control-group h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 16px;
            font-weight: 600;
        }

        .control-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }

        .control-item label {
            min-width: 80px;
            font-size: 14px;
            color: #666;
        }

        input[type="color"] {
            width: 40px;
            height: 30px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        input[type="range"] {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .admin-section {
            margin-bottom: 20px;
        }

        .admin-section h4 {
            margin-bottom: 10px;
            color: #444;
            font-size: 14px;
            font-weight: 500;
        }

        .selection-area {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            position: relative;
        }

        .autocomplete-container {
            position: relative;
            flex: 1;
        }

        .autocomplete-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 4px 4px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: none;
        }

        .autocomplete-suggestion {
            padding: 8px 12px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
        }

        .autocomplete-suggestion:hover {
            background-color: #f5f5f5;
        }

        .autocomplete-suggestion.highlighted {
            background-color: #007cbf;
            color: white;
        }

        .autocomplete-suggestion:last-child {
            border-bottom: none;
        }

        input[type="text"] {
            flex: 1;
>>>>>>> 9cbbffc9194a95ec4b26df718026ec932a7e096e
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
<<<<<<< HEAD
        
        input[type="color"] {
            height: 40px;
            padding: 2px;
        }
        
        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .checkbox-wrapper input[type="checkbox"] {
            width: auto;
        }
        
        .selected-districts {
            max-height: 200px;
            overflow-y: auto;
            background: #f9f9f9;
            padding: 8px;
            border-radius: 4px;
            margin-top: 8px;
        }
        
        .district-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 8px;
            margin: 2px 0;
            background: white;
            border-radius: 3px;
            font-size: 12px;
        }
        
        .district-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            border: 1px solid #ccc;
        }
        
        .remove-btn {
            background: #ff4444;
=======

        .add-btn {
            padding: 8px 12px;
            background: #007cbf;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }

        .add-btn:hover {
            background: #005a8f;
        }

        .export-btn {
            background: #28a745;
            font-weight: 500;
        }

        .export-btn:hover {
            background: #218838;
        }

        .selected-items {
            max-height: 120px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 4px;
            padding: 8px;
            background: #f9f9f9;
        }

        .selected-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 4px 8px;
            margin-bottom: 4px;
            background: white;
            border-radius: 3px;
            border: 1px solid #ddd;
            font-size: 13px;
        }

        .selected-item span {
            flex: 1;
            margin-right: 8px;
        }

        .selected-item input[type="color"] {
            width: 25px;
            height: 25px;
            margin-right: 5px;
        }

        .remove-btn {
            background: #dc3545;
>>>>>>> 9cbbffc9194a95ec4b26df718026ec932a7e096e
            color: white;
            border: none;
            border-radius: 3px;
            padding: 2px 6px;
            cursor: pointer;
<<<<<<< HEAD
            font-size: 10px;
        }
        
        .remove-btn:hover {
            background: #cc0000;
        }
        
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 5px;
        }
        
        button:hover {
            background: #005c87;
=======
            font-size: 11px;
        }

        .remove-btn:hover {
            background: #c82333;
        }

        datalist {
            max-height: 200px;
        }

        .width-display {
            margin-left: 10px;
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
>>>>>>> 9cbbffc9194a95ec4b26df718026ec932a7e096e
        }
    </style>
</head>
<body>
<<<<<<< HEAD
    <div id="map"></div>
    
    <div class="controls">
        <div class="control-group">
            <label for="style-select">ì§€ë„ ìŠ¤íƒ€ì¼</label>
            <select id="style-select">
                <option value="mapbox://styles/mmjjpp/cmfto0pnq00hv01r814rrhzgc">ë‹¨ìƒ‰</option>
                <option value="mapbox://styles/mmjjpp/cmfuo9ni000j701rf3ha412sg">Satellite</option>
                <option value="mapbox://styles/mmjjpp/cmfuohp8700go01sj1hv65fa0">Road</option>
                <option value="mapbox://styles/mmjjpp/cmfuoqlot00ix01r80bzu6p8t">Road_Bright</option>
            </select>
        </div>
        
        <div class="control-group">
            <div class="checkbox-wrapper">
                <input type="checkbox" id="korea-boundary" checked>
                <label for="korea-boundary">í•œêµ­ ê²½ê³„ í‘œì‹œ</label>
            </div>
        </div>
        
        <div class="control-group">
            <label for="district-color">ì„ íƒ êµ¬ì—­ ìƒ‰ìƒ</label>
            <input type="color" id="district-color" value="#ff0000">
        </div>
        
        <div class="control-group">
            <label for="sigungu-search">ì‹œêµ°êµ¬ ê²€ìƒ‰</label>
            <input type="text" id="sigungu-search" list="sigungu-list" placeholder="ì‹œêµ°êµ¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            <datalist id="sigungu-list"></datalist>
            <button onclick="addDistrict('sigungu')">ì‹œêµ°êµ¬ ì¶”ê°€</button>
        </div>
        
        <div class="control-group">
            <label for="dong-search">ìë©´ë™ ê²€ìƒ‰</label>
            <input type="text" id="dong-search" list="dong-list" placeholder="ìë©´ë™ì„ ì…ë ¥í•˜ì„¸ìš”">
            <datalist id="dong-list"></datalist>
            <button onclick="addDistrict('dong')">ìë©´ë™ ì¶”ê°€</button>
        </div>
        
        <div class="control-group">
            <label>ì„ íƒëœ êµ¬ì—­</label>
            <div class="selected-districts" id="selected-districts">
                ì„ íƒëœ êµ¬ì—­ì´ ì—†ìŠµë‹ˆë‹¤.
            </div>
            <button onclick="clearAllDistricts()">ì „ì²´ ì œê±°</button>
        </div>
    </div>

    <script>
        // Mapbox access token
        mapboxgl.accessToken = 'pk.eyJ1IjoibW1qanBwIiwiYSI6ImNtZmZnM3RwODBoYnEya3B6bnB3NW5zcHQifQ.6UON_8x8X84bxsCrURuggA';
        
        // Initialize map
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mmjjpp/cmfto0pnq00hv01r814rrhzgc', // Default ë‹¨ìƒ‰ style
            center: [127.7669, 35.9078], // South Korea center
            zoom: 6.5
        });
        
        // Track selected districts
        let selectedDistricts = [];
        let distinctNames = {
            sigungu: new Set(),
            dong: new Set()
        };
        
        map.on('load', function() {
            // Add Korea boundary source and layer
            map.addSource('korea-boundary', {
                'type': 'vector',
                'url': 'mapbox://mapbox.country-boundaries-v1'
            });
            
            map.addLayer({
                'id': 'korea-boundary-layer',
                'type': 'line',
                'source': 'korea-boundary',
                'source-layer': 'country_boundaries',
                'filter': ['==', 'iso_3166_1', 'KR'],
                'paint': {
                    'line-color': '#000000',
                    'line-width': 2,
                    'line-opacity': 0.8
                }
            });
            
            // Add administrative district sources
            map.addSource('sigungu-source', {
                'type': 'vector',
                'url': 'mapbox://mmjjpp.b4x5ixng'
            });
            
            map.addSource('dong-source', {
                'type': 'vector',
                'url': 'mapbox://mmjjpp.53755csu'
            });
            
            // Load district names for datalists
            loadDistrictNames();
        });
        
        // Style selector
        document.getElementById('style-select').addEventListener('change', function(e) {
            map.setStyle(e.target.value);
            
            // Re-add sources and layers after style change
            map.once('styledata', function() {
                // Re-add Korea boundary
                if (document.getElementById('korea-boundary').checked) {
                    addKoreaBoundary();
                }
                
                // Re-add district sources
                addDistrictSources();
                
                // Re-apply selected districts
                reapplySelectedDistricts();
            });
        });
        
        // Korea boundary toggle
        document.getElementById('korea-boundary').addEventListener('change', function(e) {
            if (e.target.checked) {
                addKoreaBoundary();
            } else {
                if (map.getLayer('korea-boundary-layer')) {
                    map.removeLayer('korea-boundary-layer');
                }
                if (map.getSource('korea-boundary')) {
                    map.removeSource('korea-boundary');
                }
            }
        });
        
        function addKoreaBoundary() {
            if (!map.getSource('korea-boundary')) {
                map.addSource('korea-boundary', {
                    'type': 'vector',
                    'url': 'mapbox://mapbox.country-boundaries-v1'
                });
            }
            
            if (!map.getLayer('korea-boundary-layer')) {
                map.addLayer({
                    'id': 'korea-boundary-layer',
                    'type': 'line',
                    'source': 'korea-boundary',
                    'source-layer': 'country_boundaries',
                    'filter': ['==', 'iso_3166_1', 'KR'],
                    'paint': {
                        'line-color': '#000000',
                        'line-width': 2,
                        'line-opacity': 0.8
                    }
                });
            }
        }
        
        function addDistrictSources() {
            if (!map.getSource('sigungu-source')) {
                map.addSource('sigungu-source', {
                    'type': 'vector',
                    'url': 'mapbox://mmjjpp.b4x5ixng'
                });
            }
            
            if (!map.getSource('dong-source')) {
                map.addSource('dong-source', {
                    'type': 'vector',
                    'url': 'mapbox://mmjjpp.53755csu'
                });
            }
        }
        
        function loadDistrictNames() {
            // This would typically be loaded from the tileset data
            // For now, we'll populate with some example names
            // In a real implementation, you'd query the tileset features
            
            // Example data - replace with actual data loading
            const sigunguExamples = [
                'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬', 'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë™êµ¬', 'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë¶êµ¬', 'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ì„œêµ¬',
                'ë¶€ì‚°ê´‘ì—­ì‹œ í•´ìš´ëŒ€êµ¬', 'ë¶€ì‚°ê´‘ì—­ì‹œ ë¶€ì‚°ì§„êµ¬', 'ë¶€ì‚°ê´‘ì—­ì‹œ ë™ë˜êµ¬',
                'ì¸ì²œê´‘ì—­ì‹œ ì—°ìˆ˜êµ¬', 'ì¸ì²œê´‘ì—­ì‹œ ë‚¨ë™êµ¬', 'ëŒ€êµ¬ê´‘ì—­ì‹œ ì¤‘êµ¬'
            ];
            
            const dongExamples = [
                'ì—­ì‚¼ë™', 'ì‚¼ì„±ë™', 'ë…¼í˜„ë™', 'ì••êµ¬ì •ë™', 'ì²­ë‹´ë™',
                'í•´ìš´ëŒ€ë™', 'ìš°ë™', 'ì¤‘ë™', 'ì¢Œë™', 'ì†¡ì •ë™'
            ];
            
            populateDatalist('sigungu-list', sigunguExamples);
            populateDatalist('dong-list', dongExamples);
        }
        
        function populateDatalist(listId, items) {
            const datalist = document.getElementById(listId);
            datalist.innerHTML = '';
            items.forEach(item => {
                const option = document.createElement('option');
                option.value = item;
                datalist.appendChild(option);
            });
        }
        
        function addDistrict(type) {
            const inputId = type === 'sigungu' ? 'sigungu-search' : 'dong-search';
            const input = document.getElementById(inputId);
            const districtName = input.value.trim();
            const color = document.getElementById('district-color').value;
            
            if (!districtName) {
                alert('êµ¬ì—­ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // Check if already selected
            if (selectedDistricts.some(d => d.name === districtName && d.type === type)) {
                alert('ì´ë¯¸ ì„ íƒëœ êµ¬ì—­ì…ë‹ˆë‹¤.');
                return;
            }
            
            const district = {
                name: districtName,
                type: type,
                color: color,
                id: `${type}-${Date.now()}-${Math.random()}`
            };
            
            selectedDistricts.push(district);
            addDistrictLayer(district);
            updateSelectedDistrictsDisplay();
=======
    <div class="controls">
        <h2 style="margin-bottom: 25px; color: #333;">Korean Administrative Map</h2>
        
        <!-- Map Style Controls -->
        <div class="control-group">
            <h3>Map Style</h3>
            <div class="control-item">
                <label>Ocean:</label>
                <input type="color" id="oceanColor" value="#a6cee3">
            </div>
            <div class="control-item">
                <label>Land:</label>
                <input type="color" id="landColor" value="#f0f0f0">
            </div>
            <div class="control-item">
                <label>í•œêµ­ë§Œ ë³´ì´ê¸°:</label>
                <input type="checkbox" id="showKoreaOnly" checked>
            </div>
            <div class="control-item">
                <label>Waterways:</label>
                <input type="checkbox" id="showWaterways">
            </div>
        </div>

        <!-- Boundary Controls -->
        <div class="control-group">
            <h3>Boundaries</h3>
            
            <!-- ì‹œë„ Boundaries (always visible) -->
            <div class="admin-section">
                <h4>ì‹œë„ Boundaries</h4>
                <div class="control-item">
                    <label>Color:</label>
                    <input type="color" id="sidoBoundaryColor" value="#333333">
                </div>
                <div class="control-item">
                    <label>Width:</label>
                    <input type="range" id="sidoBoundaryWidth" min="0.5" max="5" step="0.5" value="2">
                    <span class="width-display" id="sidoWidthDisplay">2px</span>
                </div>
                <div class="control-item">
                    <label>Dashed:</label>
                    <input type="checkbox" id="sidoDashedBoundary">
                </div>
            </div>

            <!-- ì‹œêµ°êµ¬ Boundaries -->
            <div class="admin-section">
                <h4>ì‹œêµ°êµ¬ Boundaries</h4>
                <div class="control-item">
                    <label>Show:</label>
                    <input type="checkbox" id="showSigunguBoundary">
                </div>
                <div class="control-item">
                    <label>Color:</label>
                    <input type="color" id="sigunguBoundaryColor" value="#666666">
                </div>
                <div class="control-item">
                    <label>Width:</label>
                    <input type="range" id="sigunguBoundaryWidth" min="0.5" max="5" step="0.5" value="1">
                    <span class="width-display" id="sigunguWidthDisplay">1px</span>
                </div>
                <div class="control-item">
                    <label>Dashed:</label>
                    <input type="checkbox" id="sigunguDashedBoundary">
                </div>
            </div>

            <!-- ìë©´ë™ Boundaries -->
            <div class="admin-section">
                <h4>ìë©´ë™ Boundaries</h4>
                <div class="control-item">
                    <label>Show:</label>
                    <input type="checkbox" id="showEubmyeondongBoundary">
                </div>
                <div class="control-item">
                    <label>Color:</label>
                    <input type="color" id="eubmyeondongBoundaryColor" value="#999999">
                </div>
                <div class="control-item">
                    <label>Width:</label>
                    <input type="range" id="eubmyeondongBoundaryWidth" min="0.5" max="5" step="0.5" value="0.5">
                    <span class="width-display" id="eubmyeondongWidthDisplay">0.5px</span>
                </div>
                <div class="control-item">
                    <label>Dashed:</label>
                    <input type="checkbox" id="eubmyeondongDashedBoundary">
                </div>
            </div>
        </div>

        <div class="control-group">
            <h3>Export</h3>
            <button class="add-btn export-btn" onclick="exportToPNG()" style="width: 100%;">ğŸ“· Save as PNG</button>
        </div>

        <!-- Administrative Divisions -->
        <div class="control-group">
            <h3>Administrative Divisions</h3>
            
            <!-- ì‹œë„ Section -->
            <div class="admin-section">
                <h4>ì‹œë„ (Provinces)</h4>
                <div class="selection-area">
                    <input type="text" id="sidoInput" list="sidoList" placeholder="Select ì‹œë„...">
                    <input type="color" id="sidoColor" value="#ff6b6b">
                    <button class="add-btn" onclick="addSelection('sido')">Add</button>
                </div>
                <datalist id="sidoList"></datalist>
                <div class="selected-items" id="sidoSelected"></div>
            </div>

            <!-- ì‹œêµ°êµ¬ Section -->
            <div class="admin-section">
                <h4>ì‹œêµ°êµ¬ (Cities/Counties)</h4>
                <div class="selection-area">
                    <div class="autocomplete-container">
                        <input type="text" id="sigunguInput" placeholder="Type ì‹œêµ°êµ¬ name..." autocomplete="off">
                        <div class="autocomplete-suggestions" id="sigunguSuggestions"></div>
                    </div>
                    <input type="color" id="sigunguColor" value="#4ecdc4">
                    <button class="add-btn" onclick="addSelection('sigungu')">Add</button>
                </div>
                <div class="selected-items" id="sigunguSelected"></div>
            </div>

            <!-- ìë©´ë™ Section -->
            <div class="admin-section">
                <h4>ìë©´ë™ (Towns/Neighborhoods)</h4>
                <div class="selection-area">
                    <div class="autocomplete-container">
                        <input type="text" id="eubmyeondongInput" placeholder="Type ìë©´ë™ name..." autocomplete="off">
                        <div class="autocomplete-suggestions" id="eubmyeondongSuggestions"></div>
                    </div>
                    <input type="color" id="eubmyeondongColor" value="#45b7d1">
                    <button class="add-btn" onclick="addSelection('eubmyeondong')">Add</button>
                </div>
                <div class="selected-items" id="eubmyeondongSelected"></div>
            </div>
        </div>
    </div>

    <div id="map"></div>

    <script>
        // Initialize Mapbox
        mapboxgl.accessToken = 'pk.eyJ1IjoibW1qanBwIiwiYSI6ImNtZmZnM3RwODBoYnEya3B6bnB3NW5zcHQifQ.6UON_8x8X84bxsCrURuggA';

        const map = new mapboxgl.Map({
            container: 'map',
            style: {
                version: 8,
                sources: {
                    'country-boundaries': {
                        type: 'vector',
                        url: 'mapbox://mapbox.country-boundaries-v1'
                    },
                    'mapbox-streets': {
                        type: 'vector',
                        url: 'mapbox://mapbox.mapbox-streets-v8'
                    }
                },
                layers: [
                    {
                        id: 'background',
                        type: 'background',
                        paint: {
                            'background-color': '#a6cee3'
                        }
                    },
                    {
                        id: 'land',
                        type: 'fill',
                        source: 'country-boundaries',
                        'source-layer': 'country_boundaries',
                        filter: ['==', 'iso_3166_1', 'KR'],
                        paint: {
                            'fill-color': '#f0f0f0'
                        }
                    },
                    {
                        id: 'waterways',
                        type: 'line',
                        source: 'mapbox-streets',
                        'source-layer': 'waterway',
                        layout: {
                            'visibility': 'none'
                        },
                        paint: {
                            'line-color': '#4a90e2',
                            'line-width': [
                                'interpolate',
                                ['linear'],
                                ['zoom'],
                                5, 0.5,
                                10, 2,
                                15, 4
                            ]
                        }
                    }
                ]
            },
            center: [127.7669, 35.9078],
            zoom: 6
        });

        // Administrative data storage
        const adminData = {
            sido: { 
                tileset: 'mmjjpp.25rm7fx4',
                field: 'SIDO_NM',
                names: [],
                selected: new Map()
            },
            sigungu: { 
                tileset: 'mmjjpp.b4x5ixng',
                field: 'SIGUNGU_NM',
                names: [],
                selected: new Map()
            },
            eubmyeondong: { 
                tileset: 'mmjjpp.53755csu',
                field: 'ADM_NM',
                names: [],
                selected: new Map()
            }
        };

        // Initialize map
        map.on('load', () => {
            // Add sources
            map.addSource('sido-source', {
                type: 'vector',
                url: `mapbox://${adminData.sido.tileset}`
            });

            map.addSource('sigungu-source', {
                type: 'vector',
                url: `mapbox://${adminData.sigungu.tileset}`
            });

            map.addSource('eubmyeondong-source', {
                type: 'vector',
                url: `mapbox://${adminData.eubmyeondong.tileset}`
            });

            // Add boundary layers
            addBoundaryLayers();

            // Add fill layers for selected regions
            addFillLayers();

            // Load administrative names
            loadAdminNames();

            // Initialize map style with current color values
            updateMapStyle();
        });

        function addBoundaryLayers() {
            // ì‹œë„ boundaries (always visible, all zoom levels)
            map.addLayer({
                id: 'sido-boundaries',
                type: 'line',
                source: 'sido-source',
                'source-layer': 'BND_SIDO_PG-b2cuck',
                layout: {
                    'visibility': 'visible'
                },
                paint: {
                    'line-color': '#333333',
                    'line-width': 2,
                    'line-dasharray': [1, 0]
                },
                minzoom: 0,
                maxzoom: 24
            });

            // ì‹œêµ°êµ¬ boundaries (initially hidden, all zoom levels when visible)
            map.addLayer({
                id: 'sigungu-boundaries',
                type: 'line',
                source: 'sigungu-source',
                'source-layer': 'BND_SIGUNGU_PG-8djgqa',
                layout: {
                    'visibility': 'none'
                },
                paint: {
                    'line-color': '#666666',
                    'line-width': 1,
                    'line-dasharray': [1, 0]
                },
                minzoom: 0,
                maxzoom: 24
            });

            // ìë©´ë™ boundaries (initially hidden, all zoom levels when visible)
            map.addLayer({
                id: 'eubmyeondong-boundaries',
                type: 'line',
                source: 'eubmyeondong-source',
                'source-layer': 'BND_ADM_DONG_PG-3p138h',
                layout: {
                    'visibility': 'none'
                },
                paint: {
                    'line-color': '#999999',
                    'line-width': 0.5,
                    'line-dasharray': [1, 0]
                },
                minzoom: 0,
                maxzoom: 24
            });
        }

        function addFillLayers() {
            // ì‹œë„ fills (all zoom levels)
            map.addLayer({
                id: 'sido-fill',
                type: 'fill',
                source: 'sido-source',
                'source-layer': 'BND_SIDO_PG-b2cuck',
                paint: {
                    'fill-color': [
                        'case',
                        ['has', ['get', 'SIDO_NM'], ['literal', {}]],
                        ['get', ['get', 'SIDO_NM'], ['literal', {}]],
                        'rgba(0,0,0,0)'
                    ],
                    'fill-opacity': 0.7
                },
                minzoom: 0,
                maxzoom: 24
            }, 'sido-boundaries');

            // ì‹œêµ°êµ¬ fills (all zoom levels)
            map.addLayer({
                id: 'sigungu-fill',
                type: 'fill',
                source: 'sigungu-source',
                'source-layer': 'BND_SIGUNGU_PG-8djgqa',
                paint: {
                    'fill-color': [
                        'case',
                        ['has', ['get', 'SIGUNGU_NM'], ['literal', {}]],
                        ['get', ['get', 'SIGUNGU_NM'], ['literal', {}]],
                        'rgba(0,0,0,0)'
                    ],
                    'fill-opacity': 0.7
                },
                minzoom: 0,
                maxzoom: 24
            }, 'sigungu-boundaries');

            // ìë©´ë™ fills (all zoom levels)
            map.addLayer({
                id: 'eubmyeondong-fill',
                type: 'fill',
                source: 'eubmyeondong-source',
                'source-layer': 'BND_ADM_DONG_PG-3p138h',
                paint: {
                    'fill-color': [
                        'case',
                        ['has', ['get', 'ADM_NM'], ['literal', {}]],
                        ['get', ['get', 'ADM_NM'], ['literal', {}]],
                        'rgba(0,0,0,0)'
                    ],
                    'fill-opacity': 0.7
                },
                minzoom: 0,
                maxzoom: 24
            }, 'eubmyeondong-boundaries');
        }

        async function loadAdminNames() {
            // Complete ì‹œë„ list
            adminData.sido.names = [
                'ì„œìš¸íŠ¹ë³„ì‹œ', 'ë¶€ì‚°ê´‘ì—­ì‹œ', 'ëŒ€êµ¬ê´‘ì—­ì‹œ', 'ì¸ì²œê´‘ì—­ì‹œ', 'ê´‘ì£¼ê´‘ì—­ì‹œ',
                'ëŒ€ì „ê´‘ì—­ì‹œ', 'ìš¸ì‚°ê´‘ì—­ì‹œ', 'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ', 'ê²½ê¸°ë„', 'ê°•ì›ë„',
                'ì¶©ì²­ë¶ë„', 'ì¶©ì²­ë‚¨ë„', 'ì „ë¼ë¶ë„', 'ì „ë¼ë‚¨ë„', 'ê²½ìƒë¶ë„', 'ê²½ìƒë‚¨ë„', 'ì œì£¼íŠ¹ë³„ìì¹˜ë„'
            ];

            // Comprehensive ì‹œêµ°êµ¬ list
            adminData.sigungu.names = [
                // ì„œìš¸ 25ê°œ êµ¬
                'ì¢…ë¡œêµ¬', 'ì¤‘êµ¬', 'ìš©ì‚°êµ¬', 'ì„±ë™êµ¬', 'ê´‘ì§„êµ¬', 'ë™ëŒ€ë¬¸êµ¬', 'ì¤‘ë‘êµ¬', 'ì„±ë¶êµ¬', 'ê°•ë¶êµ¬', 'ë„ë´‰êµ¬',
                'ë…¸ì›êµ¬', 'ì€í‰êµ¬', 'ì„œëŒ€ë¬¸êµ¬', 'ë§ˆí¬êµ¬', 'ì–‘ì²œêµ¬', 'ê°•ì„œêµ¬', 'êµ¬ë¡œêµ¬', 'ê¸ˆì²œêµ¬', 'ì˜ë“±í¬êµ¬', 'ë™ì‘êµ¬',
                'ê´€ì•…êµ¬', 'ì„œì´ˆêµ¬', 'ê°•ë‚¨êµ¬', 'ì†¡íŒŒêµ¬', 'ê°•ë™êµ¬',
                // ë¶€ì‚° 16ê°œ êµ¬/êµ°
                'ì¤‘êµ¬', 'ì„œêµ¬', 'ë™êµ¬', 'ì˜ë„êµ¬', 'ë¶€ì‚°ì§„êµ¬', 'ë™ë˜êµ¬', 'ë‚¨êµ¬', 'ë¶êµ¬', 'í•´ìš´ëŒ€êµ¬', 'ì‚¬í•˜êµ¬',
                'ê¸ˆì •êµ¬', 'ê°•ì„œêµ¬', 'ì—°ì œêµ¬', 'ìˆ˜ì˜êµ¬', 'ì‚¬ìƒêµ¬', 'ê¸°ì¥êµ°',
                // ëŒ€êµ¬ 8ê°œ êµ¬/êµ°
                'ì¤‘êµ¬', 'ë™êµ¬', 'ì„œêµ¬', 'ë‚¨êµ¬', 'ë¶êµ¬', 'ìˆ˜ì„±êµ¬', 'ë‹¬ì„œêµ¬', 'ë‹¬ì„±êµ°',
                // ì¸ì²œ 10ê°œ êµ¬/êµ°
                'ì¤‘êµ¬', 'ë™êµ¬', 'ë¯¸ì¶”í™€êµ¬', 'ì—°ìˆ˜êµ¬', 'ë‚¨ë™êµ¬', 'ë¶€í‰êµ¬', 'ê³„ì–‘êµ¬', 'ì„œêµ¬', 'ê°•í™”êµ°', 'ì˜¹ì§„êµ°',
                // ê´‘ì£¼ 5ê°œ êµ¬
                'ë™êµ¬', 'ì„œêµ¬', 'ë‚¨êµ¬', 'ë¶êµ¬', 'ê´‘ì‚°êµ¬',
                // ëŒ€ì „ 5ê°œ êµ¬
                'ë™êµ¬', 'ì¤‘êµ¬', 'ì„œêµ¬', 'ìœ ì„±êµ¬', 'ëŒ€ë•êµ¬',
                // ìš¸ì‚° 5ê°œ êµ¬/êµ°
                'ì¤‘êµ¬', 'ë‚¨êµ¬', 'ë™êµ¬', 'ë¶êµ¬', 'ìš¸ì£¼êµ°',
                // ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ
                'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ',
                // ê²½ê¸°ë„ ì£¼ìš” ì‹œ/êµ°
                'ìˆ˜ì›ì‹œ', 'ì„±ë‚¨ì‹œ', 'ê³ ì–‘ì‹œ', 'ìš©ì¸ì‹œ', 'ë¶€ì²œì‹œ', 'ì•ˆì‚°ì‹œ', 'ì•ˆì–‘ì‹œ', 'ë‚¨ì–‘ì£¼ì‹œ', 'í™”ì„±ì‹œ', 'í‰íƒì‹œ',
                'ì˜ì •ë¶€ì‹œ', 'ì‹œí¥ì‹œ', 'íŒŒì£¼ì‹œ', 'ê´‘ëª…ì‹œ', 'ê¹€í¬ì‹œ', 'êµ°í¬ì‹œ', 'ê´‘ì£¼ì‹œ', 'ì´ì²œì‹œ', 'ì–‘ì£¼ì‹œ', 'ì˜¤ì‚°ì‹œ',
                'êµ¬ë¦¬ì‹œ', 'ì•ˆì„±ì‹œ', 'í¬ì²œì‹œ', 'ì˜ì™•ì‹œ', 'í•˜ë‚¨ì‹œ', 'ì—¬ì£¼ì‹œ', 'ë™ë‘ì²œì‹œ', 'ê³¼ì²œì‹œ', 'ê°€í‰êµ°', 'ì–‘í‰êµ°', 'ì—°ì²œêµ°',
                // ê°•ì›ë„ ì£¼ìš” ì‹œ/êµ°
                'ì¶˜ì²œì‹œ', 'ì›ì£¼ì‹œ', 'ê°•ë¦‰ì‹œ', 'ë™í•´ì‹œ', 'íƒœë°±ì‹œ', 'ì†ì´ˆì‹œ', 'ì‚¼ì²™ì‹œ', 'í™ì²œêµ°', 'íš¡ì„±êµ°', 'ì˜ì›”êµ°',
                'í‰ì°½êµ°', 'ì •ì„ êµ°', 'ì² ì›êµ°', 'í™”ì²œêµ°', 'ì–‘êµ¬êµ°', 'ì¸ì œêµ°', 'ê³ ì„±êµ°', 'ì–‘ì–‘êµ°',
                // ì¶©ì²­ë¶ë„ ì£¼ìš” ì‹œ/êµ°
                'ì²­ì£¼ì‹œ', 'ì¶©ì£¼ì‹œ', 'ì œì²œì‹œ', 'ë³´ì€êµ°', 'ì˜¥ì²œêµ°', 'ì˜ë™êµ°', 'ì¦í‰êµ°', 'ì§„ì²œêµ°', 'ê´´ì‚°êµ°', 'ìŒì„±êµ°', 'ë‹¨ì–‘êµ°',
                // ì¶©ì²­ë‚¨ë„ ì£¼ìš” ì‹œ/êµ°
                'ì²œì•ˆì‹œ', 'ê³µì£¼ì‹œ', 'ë³´ë ¹ì‹œ', 'ì•„ì‚°ì‹œ', 'ì„œì‚°ì‹œ', 'ë…¼ì‚°ì‹œ', 'ê³„ë£¡ì‹œ', 'ë‹¹ì§„ì‹œ', 'ê¸ˆì‚°êµ°', 'ë¶€ì—¬êµ°',
                'ì„œì²œêµ°', 'ì²­ì–‘êµ°', 'í™ì„±êµ°', 'ì˜ˆì‚°êµ°', 'íƒœì•ˆêµ°',
                // ì „ë¼ë¶ë„ ì£¼ìš” ì‹œ/êµ°
                'ì „ì£¼ì‹œ', 'êµ°ì‚°ì‹œ', 'ìµì‚°ì‹œ', 'ì •ìì‹œ', 'ë‚¨ì›ì‹œ', 'ê¹€ì œì‹œ', 'ì™„ì£¼êµ°', 'ì§„ì•ˆêµ°', 'ë¬´ì£¼êµ°', 'ì¥ìˆ˜êµ°',
                'ì„ì‹¤êµ°', 'ìˆœì°½êµ°', 'ê³ ì°½êµ°', 'ë¶€ì•ˆêµ°',
                // ì „ë¼ë‚¨ë„ ì£¼ìš” ì‹œ/êµ°
                'ëª©í¬ì‹œ', 'ì—¬ìˆ˜ì‹œ', 'ìˆœì²œì‹œ', 'ë‚˜ì£¼ì‹œ', 'ê´‘ì–‘ì‹œ', 'ë‹´ì–‘êµ°', 'ê³¡ì„±êµ°', 'êµ¬ë¡€êµ°', 'ê³ í¥êµ°', 'ë³´ì„±êµ°',
                'í™”ìˆœêµ°', 'ì¥í¥êµ°', 'ê°•ì§„êµ°', 'í•´ë‚¨êµ°', 'ì˜ì•”êµ°', 'ë¬´ì•ˆêµ°', 'í•¨í‰êµ°', 'ì˜ê´‘êµ°', 'ì¥ì„±êµ°', 'ì™„ë„êµ°',
                'ì§„ë„êµ°', 'ì‹ ì•ˆêµ°',
                // ê²½ìƒë¶ë„ ì£¼ìš” ì‹œ/êµ°
                'í¬í•­ì‹œ', 'ê²½ì£¼ì‹œ', 'ê¹€ì²œì‹œ', 'ì•ˆë™ì‹œ', 'êµ¬ë¯¸ì‹œ', 'ì˜ì£¼ì‹œ', 'ì˜ì²œì‹œ', 'ìƒì£¼ì‹œ', 'ë¬¸ê²½ì‹œ', 'ê²½ì‚°ì‹œ',
                'êµ°ìœ„êµ°', 'ì˜ì„±êµ°', 'ì²­ì†¡êµ°', 'ì˜ì–‘êµ°', 'ì˜ë•êµ°', 'ì²­ë„êµ°', 'ê³ ë ¹êµ°', 'ì„±ì£¼êµ°', 'ì¹ ê³¡êµ°', 'ì˜ˆì²œêµ°',
                'ë´‰í™”êµ°', 'ìš¸ì§„êµ°', 'ìš¸ë¦‰êµ°',
                // ê²½ìƒë‚¨ë„ ì£¼ìš” ì‹œ/êµ°
                'ì°½ì›ì‹œ', 'ì§„ì£¼ì‹œ', 'í†µì˜ì‹œ', 'ì‚¬ì²œì‹œ', 'ê¹€í•´ì‹œ', 'ë°€ì–‘ì‹œ', 'ê±°ì œì‹œ', 'ì–‘ì‚°ì‹œ', 'ì˜ë ¹êµ°', 'í•¨ì•ˆêµ°',
                'ì°½ë…•êµ°', 'ê³ ì„±êµ°', 'ë‚¨í•´êµ°', 'í•˜ë™êµ°', 'ì‚°ì²­êµ°', 'í•¨ì–‘êµ°', 'ê±°ì°½êµ°', 'í•©ì²œêµ°',
                // ì œì£¼íŠ¹ë³„ìì¹˜ë„
                'ì œì£¼ì‹œ', 'ì„œê·€í¬ì‹œ'
            ];

            // Comprehensive ìë©´ë™ list (sample - would need full list from actual data)
            adminData.eubmyeondong.names = [
                // ì„œìš¸ ì£¼ìš” ë™
                'ëª…ë™', 'ì¶©ë¬´ë¡œ', 'ì„ì§€ë¡œë™', 'ì‹ ë‹¹ë™', 'ë‹¤ì‚°ë™', 'ì•½ìˆ˜ë™', 'ì²­êµ¬ë™', 'ì‹ ë‹¹ë™', 'í™©í•™ë™', 'ì¤‘ë¦¼ë™',
                'í›„ì•”ë™', 'ìš©ì‚°ë™', 'í•œê°•ë¡œë™', 'ì´ì´Œë™', 'í•œë‚¨ë™', 'ì„œë¹™ê³ ë™', 'ë³´ê´‘ë™', 'ì²­íŒŒë™', 'ì›íš¨ë¡œë™',
                'ì™•ì‹­ë¦¬ë™', 'ë§ˆì¥ë™', 'ì‚¬ê·¼ë™', 'í–‰ë‹¹ë™', 'ì‘ë´‰ë™', 'ê¸ˆí˜¸ë™', 'ì˜¥ìˆ˜ë™', 'ì„±ìˆ˜ë™', 'ì†¡ì •ë™',
                'ìš©ë‹µë™', 'ì¤‘ê³¡ë™', 'ëŠ¥ë™', 'êµ¬ì˜ë™', 'ê´‘ì¥ë™', 'ìì–‘ë™', 'í™”ì–‘ë™', 'êµ°ìë™', 'ì¤‘í™”ë™',
                'ì „ë†ë™', 'ë‹µì‹­ë¦¬ë™', 'ì¥ì•ˆë™', 'ì²­ëŸ‰ë¦¬ë™', 'íšŒê¸°ë™', 'íœ˜ê²½ë™', 'ì´ë¬¸ë™', 'ìš©ë‘ë™', 'ì œê¸°ë™',
                'ì‹ ì„¤ë™', 'ë©´ëª©ë™', 'ìƒë´‰ë™', 'ì¤‘í™”ë™', 'ë¬µë™', 'ë§ìš°ë™', 'ì‹ ë‚´ë™',
                'ì„±ë¶ë™', 'ì‚¼ì„ ë™', 'ë™ì„ ë™', 'ëˆì•”ë™', 'ì•ˆì•”ë™', 'ë³´ë¬¸ë™', 'ì •ë¦‰ë™', 'ê¸¸ìŒë™', 'ì¢…ì•”ë™',
                'ë¯¸ì•„ë™', 'ë²ˆë™', 'ìˆ˜ìœ ë™', 'ìš°ì´ë™', 'ìŒë¬¸ë™', 'ë°©í•™ë™', 'ë„ë´‰ë™', 'ì°½ë™', 'ìƒê³„ë™',
                'ì¤‘ê³„ë™', 'í•˜ê³„ë™', 'ê³µë¦‰ë™', 'ì›”ê³„ë™', 'ë…¸ì›ë™', 'ìƒì›”ê³¡ë™', 'ì¤‘ì›”ê³¡ë™', 'í•˜ì›”ê³¡ë™',
                'ì‘ì•”ë™', 'ì—­ì´Œë™', 'ë¶ˆê´‘ë™', 'êµ¬ì‚°ë™', 'ëŒ€ì¡°ë™', 'ì§„ê´€ë™', 'ì‹ ì‚¬ë™', 'ì—°í¬ë™', 'í™ì œë™',
                'í™ì€ë™', 'ë‚¨ê°€ì¢Œë™', 'ë¶ê°€ì¢Œë™', 'ì¶©í˜„ë™', 'í˜„ì €ë™', 'í™ì§€ë™', 'ì‹ ì´Œë™', 'ì—°ë‚¨ë™', 'ì„±ì‚°ë™',
                'ë§ì›ë™', 'í•©ì •ë™', 'ìƒì•”ë™', 'ë§ˆí¬ë™', 'ê³µë•ë™', 'ì•„í˜„ë™', 'ìš©ê°•ë™', 'í† ì •ë™', 'ì‹ ì •ë™',
                'ëª©ë™', 'ì‹ ì›”ë™', 'ì—¼ì°½ë™', 'ë“±ì´Œë™', 'í™”ê³¡ë™', 'ìš°ì¥ì‚°ë™', 'ê°€ì–‘ë™', 'ë°œì‚°ë™', 'ê³µí•­ë™',
                'ë°©í™”ë™', 'ê°œí™”ë™', 'ê³¼í•´ë™', 'ì˜¤ê³¡ë™', 'ì˜¤ì‡ ë™', 'ì™¸ë°œì‚°ë™', 'ë“±ì´Œë™', 'í™”ê³¡ë™', 'ê°€ì–‘ë™',
                // ë¶€ì‚° ì£¼ìš” ë™
                'ì¤‘ì•™ë™', 'ë™ê´‘ë™', 'ëŒ€ì²­ë™', 'ë³´ìˆ˜ë™', 'ë¶€í‰ë™', 'ì„œë©´', 'ë¶€ì „ë™', 'ë‹¹ê°ë™', 'ê°œê¸ˆë™', 'ì—°ì‚°ë™',
                'ê±°ì œë™', 'ì—°ì§€ë™', 'ë§ë¯¸ë™', 'ë°˜ì—¬ë™', 'ì¬ì†¡ë™', 'ì„¼í…€ì‹œí‹°', 'ìš°ë™', 'ì¤‘ë™', 'ì¢Œë™', 'ì†¡ì •ë™',
                'ê¸°ì¥ì', 'ì •ê´€ì', 'ì¼ê´‘ë©´', 'ì² ë§ˆë©´', 'ì¥ì•ˆì'
            ];

            // Populate ì‹œë„ datalist
            populateDatalist('sidoList', adminData.sido.names);
            
            // Initialize autocomplete for ì‹œêµ°êµ¬ and ìë©´ë™
            initializeAutocomplete('sigungu');
            initializeAutocomplete('eubmyeondong');
        }

        function populateDatalist(listId, names) {
            const datalist = document.getElementById(listId);
            datalist.innerHTML = '';
            names.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                datalist.appendChild(option);
            });
        }

        // Autocomplete functionality
        function initializeAutocomplete(type) {
            const input = document.getElementById(`${type}Input`);
            const suggestionsDiv = document.getElementById(`${type}Suggestions`);
            let currentHighlight = -1;
            
            input.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                const suggestions = adminData[type].names.filter(name => 
                    name.toLowerCase().includes(value)
                ).slice(0, 10); // Limit to 10 suggestions
                
                showSuggestions(suggestions, suggestionsDiv, input, type);
                currentHighlight = -1;
            });
            
            input.addEventListener('keydown', function(e) {
                const suggestions = suggestionsDiv.querySelectorAll('.autocomplete-suggestion');
                
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    currentHighlight = Math.min(currentHighlight + 1, suggestions.length - 1);
                    updateHighlight(suggestions, currentHighlight);
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    currentHighlight = Math.max(currentHighlight - 1, -1);
                    updateHighlight(suggestions, currentHighlight);
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    if (currentHighlight >= 0 && suggestions[currentHighlight]) {
                        selectSuggestion(suggestions[currentHighlight].textContent, input, suggestionsDiv);
                    } else if (this.value.trim()) {
                        selectSuggestion(this.value.trim(), input, suggestionsDiv);
                    }
                } else if (e.key === 'Escape') {
                    hideSuggestions(suggestionsDiv);
                    currentHighlight = -1;
                }
            });
            
            input.addEventListener('blur', function() {
                // Delay hiding to allow for clicks on suggestions
                setTimeout(() => hideSuggestions(suggestionsDiv), 150);
            });
            
            input.addEventListener('focus', function() {
                if (this.value) {
                    const value = this.value.toLowerCase();
                    const suggestions = adminData[type].names.filter(name => 
                        name.toLowerCase().includes(value)
                    ).slice(0, 10);
                    showSuggestions(suggestions, suggestionsDiv, input, type);
                }
            });
        }
        
        function showSuggestions(suggestions, suggestionsDiv, input, type) {
            suggestionsDiv.innerHTML = '';
            
            if (suggestions.length === 0 || !input.value.trim()) {
                suggestionsDiv.style.display = 'none';
                return;
            }
            
            suggestions.forEach(suggestion => {
                const div = document.createElement('div');
                div.className = 'autocomplete-suggestion';
                div.textContent = suggestion;
                div.addEventListener('click', function() {
                    selectSuggestion(suggestion, input, suggestionsDiv);
                });
                suggestionsDiv.appendChild(div);
            });
            
            suggestionsDiv.style.display = 'block';
        }
        
        function hideSuggestions(suggestionsDiv) {
            suggestionsDiv.style.display = 'none';
        }
        
        function updateHighlight(suggestions, highlightIndex) {
            suggestions.forEach((suggestion, index) => {
                suggestion.classList.toggle('highlighted', index === highlightIndex);
            });
        }
        
        function selectSuggestion(value, input, suggestionsDiv) {
            input.value = value;
            hideSuggestions(suggestionsDiv);
            input.focus();
        }

        // Control event listeners
        document.getElementById('oceanColor').addEventListener('change', updateMapStyle);
        document.getElementById('landColor').addEventListener('change', updateMapStyle);
        document.getElementById('showKoreaOnly').addEventListener('change', toggleKoreaOnly);
        document.getElementById('showWaterways').addEventListener('change', toggleWaterways);

        // ì‹œë„ boundary controls
        document.getElementById('sidoBoundaryColor').addEventListener('change', () => updateBoundaryStyle('sido'));
        document.getElementById('sidoBoundaryWidth').addEventListener('input', () => updateBoundaryStyle('sido'));
        document.getElementById('sidoDashedBoundary').addEventListener('change', () => updateBoundaryStyle('sido'));

        // ì‹œêµ°êµ¬ boundary controls
        document.getElementById('showSigunguBoundary').addEventListener('change', toggleBoundaryVisibility);
        document.getElementById('sigunguBoundaryColor').addEventListener('change', () => updateBoundaryStyle('sigungu'));
        document.getElementById('sigunguBoundaryWidth').addEventListener('input', () => updateBoundaryStyle('sigungu'));
        document.getElementById('sigunguDashedBoundary').addEventListener('change', () => updateBoundaryStyle('sigungu'));

        // ìë©´ë™ boundary controls
        document.getElementById('showEubmyeondongBoundary').addEventListener('change', toggleBoundaryVisibility);
        document.getElementById('eubmyeondongBoundaryColor').addEventListener('change', () => updateBoundaryStyle('eubmyeondong'));
        document.getElementById('eubmyeondongBoundaryWidth').addEventListener('input', () => updateBoundaryStyle('eubmyeondong'));
        document.getElementById('eubmyeondongDashedBoundary').addEventListener('change', () => updateBoundaryStyle('eubmyeondong'));

        // Width display updates
        document.getElementById('sidoBoundaryWidth').addEventListener('input', (e) => {
            document.getElementById('sidoWidthDisplay').textContent = e.target.value + 'px';
        });
        document.getElementById('sigunguBoundaryWidth').addEventListener('input', (e) => {
            document.getElementById('sigunguWidthDisplay').textContent = e.target.value + 'px';
        });
        document.getElementById('eubmyeondongBoundaryWidth').addEventListener('input', (e) => {
            document.getElementById('eubmyeondongWidthDisplay').textContent = e.target.value + 'px';
        });

        function updateMapStyle() {
            const oceanColor = document.getElementById('oceanColor').value;
            const landColor = document.getElementById('landColor').value;
            
            // Update ocean/background color
            map.setPaintProperty('background', 'background-color', oceanColor);
            
            // Update land color
            if (map.getLayer('land')) {
                map.setPaintProperty('land', 'fill-color', landColor);
            }
        }

        function toggleKoreaOnly() {
            const showKoreaOnly = document.getElementById('showKoreaOnly').checked;
            
            if (showKoreaOnly) {
                // Show only Korea
                map.setFilter('land', ['==', 'iso_3166_1', 'KR']);
            } else {
                // Show all countries
                map.setFilter('land', null);
            }
        }

        function toggleWaterways() {
            const showWaterways = document.getElementById('showWaterways').checked;
            
            map.setLayoutProperty('waterways', 'visibility', showWaterways ? 'visible' : 'none');
        }

        function updateBoundaryStyle(type) {
            const boundaryColor = document.getElementById(`${type}BoundaryColor`).value;
            const boundaryWidth = parseFloat(document.getElementById(`${type}BoundaryWidth`).value);
            const isDashed = document.getElementById(`${type}DashedBoundary`).checked;
            
            const dashArray = isDashed ? [2, 2] : [1, 0];
            const layerId = `${type}-boundaries`;
            
            map.setPaintProperty(layerId, 'line-color', boundaryColor);
            map.setPaintProperty(layerId, 'line-width', boundaryWidth);
            map.setPaintProperty(layerId, 'line-dasharray', dashArray);
        }

        function toggleBoundaryVisibility() {
            const showSigungu = document.getElementById('showSigunguBoundary').checked;
            const showEubmyeondong = document.getElementById('showEubmyeondongBoundary').checked;
            
            map.setLayoutProperty('sigungu-boundaries', 'visibility', showSigungu ? 'visible' : 'none');
            map.setLayoutProperty('eubmyeondong-boundaries', 'visibility', showEubmyeondong ? 'visible' : 'none');
        }

        function addSelection(type) {
            const input = document.getElementById(`${type}Input`);
            const color = document.getElementById(`${type}Color`).value;
            const name = input.value.trim();
            
            if (!name) return;
            
            // Add to selected map
            adminData[type].selected.set(name, color);
            
            // Update display
            updateSelectedDisplay(type);
            
            // Update map
            updateFillLayer(type);
>>>>>>> 9cbbffc9194a95ec4b26df718026ec932a7e096e
            
            // Clear input
            input.value = '';
        }
<<<<<<< HEAD
        
        function addDistrictLayer(district) {
            const sourceId = district.type === 'sigungu' ? 'sigungu-source' : 'dong-source';
            const sourceLayer = district.type === 'sigungu' ? 'BND_SIGUNGU_PG-8djgqa' : 'BND_ADM_DONG_PG-3p138h';
            const fieldName = district.type === 'sigungu' ? 'SIGUNGU_NM' : 'ADM_NM';
            
            const layerId = district.id;
            
            map.addLayer({
                'id': layerId,
                'type': 'fill',
                'source': sourceId,
                'source-layer': sourceLayer,
                'filter': ['==', fieldName, district.name],
                'paint': {
                    'fill-color': district.color,
                    'fill-opacity': 0.6,
                    'fill-outline-color': district.color
                }
            });
        }
        
        function removeDistrict(districtId) {
            // Remove from array
            selectedDistricts = selectedDistricts.filter(d => d.id !== districtId);
            
            // Remove layer from map
            if (map.getLayer(districtId)) {
                map.removeLayer(districtId);
            }
            
            updateSelectedDistrictsDisplay();
        }
        
        function clearAllDistricts() {
            selectedDistricts.forEach(district => {
                if (map.getLayer(district.id)) {
                    map.removeLayer(district.id);
                }
            });
            
            selectedDistricts = [];
            updateSelectedDistrictsDisplay();
        }
        
        function updateSelectedDistrictsDisplay() {
            const container = document.getElementById('selected-districts');
            
            if (selectedDistricts.length === 0) {
                container.innerHTML = 'ì„ íƒëœ êµ¬ì—­ì´ ì—†ìŠµë‹ˆë‹¤.';
                return;
            }
            
            container.innerHTML = selectedDistricts.map(district => `
                <div class="district-item">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div class="district-color" style="background-color: ${district.color};"></div>
                        <span>${district.name}</span>
                    </div>
                    <button class="remove-btn" onclick="removeDistrict('${district.id}')">ì œê±°</button>
                </div>
            `).join('');
        }
        
        function reapplySelectedDistricts() {
            // Re-add district sources
            addDistrictSources();
            
            // Wait for sources to load, then re-add district layers
            setTimeout(() => {
                selectedDistricts.forEach(district => {
                    addDistrictLayer(district);
                });
            }, 1000);
=======

        function removeSelection(type, name) {
            adminData[type].selected.delete(name);
            updateSelectedDisplay(type);
            updateFillLayer(type);
        }

        function updateSelectedDisplay(type) {
            const container = document.getElementById(`${type}Selected`);
            container.innerHTML = '';
            
            adminData[type].selected.forEach((color, name) => {
                const item = document.createElement('div');
                item.className = 'selected-item';
                item.innerHTML = `
                    <span>${name}</span>
                    <input type="color" value="${color}" onchange="updateSelectionColor('${type}', '${name}', this.value)">
                    <button class="remove-btn" onclick="removeSelection('${type}', '${name}')">Ã—</button>
                `;
                container.appendChild(item);
            });
        }

        function updateSelectionColor(type, name, color) {
            adminData[type].selected.set(name, color);
            updateFillLayer(type);
        }

        function updateFillLayer(type) {
            const colorMap = {};
            adminData[type].selected.forEach((color, name) => {
                colorMap[name] = color;
            });
            
            map.setPaintProperty(`${type}-fill`, 'fill-color', [
                'case',
                ['has', ['get', adminData[type].field], ['literal', colorMap]],
                ['get', ['get', adminData[type].field], ['literal', colorMap]],
                'rgba(0,0,0,0)'
            ]);
        }

        // Add click handlers for interactive selection
        map.on('click', 'sido-fill', (e) => {
            const name = e.features[0].properties.SIDO_NM;
            if (name && !adminData.sido.selected.has(name)) {
                document.getElementById('sidoInput').value = name;
            }
        });

        map.on('click', 'sigungu-fill', (e) => {
            const name = e.features[0].properties.SIGUNGU_NM;
            if (name && !adminData.sigungu.selected.has(name)) {
                document.getElementById('sigunguInput').value = name;
            }
        });

        map.on('click', 'eubmyeondong-fill', (e) => {
            const name = e.features[0].properties.ADM_NM;
            if (name && !adminData.eubmyeondong.selected.has(name)) {
                document.getElementById('eubmyeondongInput').value = name;
            }
        });

        // Add cursor style for clickable areas
        map.on('mouseenter', 'sido-fill', () => map.getCanvas().style.cursor = 'pointer');
        map.on('mouseleave', 'sido-fill', () => map.getCanvas().style.cursor = '');
        map.on('mouseenter', 'sigungu-fill', () => map.getCanvas().style.cursor = 'pointer');
        map.on('mouseleave', 'sigungu-fill', () => map.getCanvas().style.cursor = '');
        map.on('mouseenter', 'eubmyeondong-fill', () => map.getCanvas().style.cursor = 'pointer');
        map.on('mouseleave', 'eubmyeondong-fill', () => map.getCanvas().style.cursor = '');

        // Close autocomplete suggestions when clicking outside
        document.addEventListener('click', function(e) {
            const autocompleteContainers = document.querySelectorAll('.autocomplete-container');
            autocompleteContainers.forEach(container => {
                if (!container.contains(e.target)) {
                    const suggestionsDiv = container.querySelector('.autocomplete-suggestions');
                    if (suggestionsDiv) {
                        hideSuggestions(suggestionsDiv);
                    }
                }
            });
        });

        // Export to PNG function
        function exportToPNG() {
            const canvas = map.getCanvas();
            const link = document.createElement('a');
            
            // Get current date and time for filename
            const now = new Date();
            const timestamp = now.toISOString().slice(0, 19).replace(/[:-]/g, '').replace('T', '_');
            const filename = `korean_admin_map_${timestamp}.png`;
            
            // Convert canvas to blob and download
            canvas.toBlob(function(blob) {
                const url = URL.createObjectURL(blob);
                link.href = url;
                link.download = filename;
                link.click();
                URL.revokeObjectURL(url);
            }, 'image/png');
>>>>>>> 9cbbffc9194a95ec4b26df718026ec932a7e096e
        }
    </script>
</body>
</html>